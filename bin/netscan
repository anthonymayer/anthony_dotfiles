#!/usr/bin/python
import commands
import os
import sys
from math import log


def checkroot():
    if (os.getuid() != 0):
	print "You are not superuser. UID =", os.getuid()
	if os.spawnlp(os.P_WAIT, "sudo", "sudo", "true"):#get root permissions
	    sys.exit(-1)

class net:
    def __init__(self, essid = "", dB = -200, crypt = "on"):
	self.essid = essid
	try:
	    self.signal = log(93.+dB) / .03
	except:
	    self.signal = 0
	self.dB = dB
	self.crypt = crypt
	if(crypt == "on"):
	    self.locked = "locked"
	else:
	    self.locked = "unlocked"

    def __str__(self):
	return "%s:\t%i%% (%idB)\t%s" \
	    % (self.essid, self.signal, self.dB, self.locked)

    def __cmp__(self, other):
	if not isinstance(other, net):
	    raise TypeError("Cannot compare 'net' to '" + str(type(other)) + "'")

	if self.crypt == other.crypt:
	    if self.signal > other.signal:
		return 1
	    elif self.signal < other.signal:
		return -1
	    else:
		return 0
	elif self.crypt == "off":
	    return 1
	else:
	    return -1


checkroot();
iwl = commands.getoutput("sudo iwlist eth1 scan | grep \"ESSID\\|Signal\\|key\"")
iwl = iwl.split("\n")
	
netlist = []
for x in xrange(0,len(iwl),3):
	print iwl[x]
	print iwl[x+1]
	print iwl[x+2]
	essid =  iwl[x].split(":")[1]
	signal =  iwl[x+1].split(":")[2].split()[0]
	crypt =  iwl[x+2].split(":")[1]
	netlist.append( net(essid, int(signal), crypt) )

"""
essid = "test"
crypt = "off"
netlist.append( net(essid, -70, crypt) )
netlist.append( net(essid, -60, crypt) )
crypt = "on"
netlist.append( net(essid, -50, crypt) )
netlist.append( net(essid, -80, crypt) )
netlist.append( net(essid, -85, crypt) )
crypt = "off"
netlist.append( net(essid, -90, crypt) )
netlist.append( net(essid, -95, crypt) )
netlist.append( net(essid, -99, crypt) )
"""

netlist.sort()
for x in netlist:
    print x
	

